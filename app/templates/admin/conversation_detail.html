{% extends "admin/base.html" %}

{% block page_title %}对话详情{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <a href="{{ url_for('admin.conversations') }}" class="btn btn-secondary">← 返回对话列表</a>
    </div>
    
    <div class="config-card">
        <h3 class="config-title">{{ conversation.title }}</h3>
        <div style="color: #666; margin-bottom: 1rem;">
            <p>对话ID: {{ conversation.id }}</p>
            <p>创建时间: {{ conversation.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p>最后更新: {{ conversation.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p>消息数量: {{ messages|length }}</p>
        </div>
    </div>
    
    <div class="config-card">
        <h3 class="config-title">对话内容</h3>
        
        {% if messages %}
        <div class="chat-messages" style="max-height: 500px; overflow-y: auto; padding: 1rem; background: #fafafa; border-radius: 4px;">
            {% for message in messages %}
            <div class="message {{ message.role }}" style="margin-bottom: 1rem; display: flex; align-items: flex-start; gap: 0.5rem; {% if message.role == 'user' %}flex-direction: row-reverse;{% endif %}">
                <div class="message-avatar" style="width: 32px; height: 32px; border-radius: 50%; {% if message.role == 'user' %}background: #007bff;{% else %}background: var(--primary-color);{% endif %} color: white; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; flex-shrink: 0;">
                    {{ 'U' if message.role == 'user' else 'AI' }}
                </div>
                <div class="message-content" style="max-width: 70%; padding: 0.75rem 1rem; border-radius: 12px; {% if message.role == 'user' %}background: var(--primary-color); color: white;{% else %}background: white; box-shadow: var(--shadow);{% endif %} word-wrap: break-word;">
                    <div>{{ message.content|replace('\n', '<br>')|safe }}</div>
                    <div style="font-size: 0.7rem; color: {% if message.role == 'user' %}rgba(255,255,255,0.8);{% else %}#999;{% endif %} margin-top: 0.25rem;">
                        {{ message.created_at.strftime('%H:%M:%S') }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 2rem; color: #666;">
            <p>此对话暂无消息</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}